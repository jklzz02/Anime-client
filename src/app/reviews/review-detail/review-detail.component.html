<div class="container mx-auto px-4 py-8 max-w-5xl">
  <div *ngIf="loading" class="flex justify-center items-center py-20">
    <div
      class="animate-spin rounded-full h-12 w-12 border-b-2 border-lavender-light dark:border-lavender"
    ></div>
  </div>

  <div *ngIf="!loading && review" class="animate-fade-in">
    <div
      class="bg-base-light dark:bg-base rounded-2xl shadow-xl border border-surface0-light dark:border-surface0 overflow-hidden mb-8"
    >
      <div class="relative h-64 md:h-80 w-full overflow-hidden">
        <img
          [src]="review.anime.image_url"
          class="absolute inset-0 w-full h-full object-cover blur-md opacity-50 scale-105"
        />
        <div
          class="absolute inset-0 bg-gradient-to-t from-base-light dark:from-base to-transparent"
        ></div>

        <div
          class="absolute bottom-0 left-0 w-full p-4 md:p-10 flex flex-row items-end gap-4 md:gap-6"
        >
          <img
            [routerLink]="['/detail', review.anime_id]"
            [src]="review.anime.image_url"
            [alt]="review.anime.title"
            class="w-24 md:w-48 rounded-lg shadow-2xl shrink-0 transition-transform hover:scale-105 duration-300 cursor-pointer hidden sm:block"
          />

          <div class="flex-grow pb-1 md:pb-2 min-w-0">
            <h2
              class="text-sm md:text-xl font-bold text-blue-light dark:text-blue mb-0.5 md:mb-1 uppercase tracking-wide opacity-90 truncate"
            >
              <a
                [routerLink]="['/detail', review.anime_id]"
                class="hover:underline"
              >
                {{ review.anime.title }}
              </a>
            </h2>
            <h1
              class="text-2xl md:text-5xl font-black text-text-light dark:text-text mb-2 md:mb-4 leading-tight drop-shadow-sm line-clamp-2 md:line-clamp-none"
              style="text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3)"
            >
              {{ review.title }}
            </h1>

            <div class="flex items-center gap-2 md:gap-4 flex-wrap">
              <div
                class="flex items-center gap-2 bg-base-light/80 dark:bg-base/80 backdrop-blur-md px-2 md:px-3 py-1 md:py-1.5 rounded-full border border-surface1-light dark:border-surface1 shadow-sm"
              >
                <img
                  [src]="review.user.picture_url"
                  class="w-5 h-5 md:w-6 md:h-6 rounded-full"
                />
                <span
                  class="text-xs md:text-sm font-semibold text-text-light dark:text-text"
                >
                  <a
                    [routerLink]="['/reviews/user', review.user.id]"
                    class="hover:text-lavender-light dark:hover:text-lavender transition-colors"this.loggedIn = 
                  >
                    {{ review.user.username }}
                  </a>
                </span>
              </div>

              <span
                class="text-xs md:text-sm text-text-light dark:text-text opacity-75 flex items-center gap-1 bg-base-light/50 dark:bg-base/50 px-2 md:px-3 py-1 md:py-1.5 rounded-full"
              >
                <i class="bi bi-calendar3"></i>
                {{ review.created_at | date : "mediumDate" }}
              </span>
            </div>
          </div>

          <div class="shrink-0 mb-1 md:mb-6">
            <div
              class="relative w-16 h-16 md:w-24 md:h-24 flex items-center justify-center rounded-full bg-base-light dark:bg-base border-2 md:border-4 border-surface0-light dark:border-surface0 shadow-xl"
            >
              <div class="text-center">
                <span
                  class="block text-xl md:text-3xl font-black text-peach-light dark:text-peach leading-none"
                  >{{ review.score }}</span
                >
                <span
                  class="text-[10px] md:text-xs text-text-light dark:text-text opacity-60 font-semibold"
                  >/ 10</span
                >
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      <div class="lg:col-span-2">
        <div
          class="bg-base-light relative dark:bg-base rounded-2xl shadow-lg border border-surface0-light dark:border-surface0 p-6 md:p-8"
        >
        <div *ngIf="isOwner" class="flex p-1 gap-2 align-middle absolute top-4 right-4">
          <button
            (click)="deleteReview()"
            class="rounded-md px-3 py-1.5  text-lg dark:bg-red-400 bg-red-600 text-white cursor-pointer"
          >
            <i class="bi bi-trash"></i>
          </button>

          <button
            class="rounded-md px-3 py-1.5 text-lg dark:bg-green bg-green-light text-white cursor-pointer"
          >
            <i class="bi bi-pencil-square"></i>          
          </button>
        </div>
          <article
            class="prose dark:prose-invert md:prose-lg max-w-none text-text-light dark:text-text"
          >
            <markdown [data]="review.content"></markdown>
          </article>
        </div>
      </div>

      <div class="lg:col-span-1 space-y-6">
        <div
          class="bg-base-light dark:bg-base rounded-xl shadow-lg border border-surface0-light dark:border-surface0 p-6"
        >
          <h3
            class="text-lg font-bold text-lavender-light dark:text-lavender mb-4 border-b border-surface0-light dark:border-surface0 pb-2"
          >
            About the Anime
          </h3>

          <div class="space-y-3">
            <div class="flex justify-between">
              <span class="text-sm text-text-light dark:text-text opacity-70"
                >Rating</span
              >
              <span
                class="text-sm font-semibold text-text-light dark:text-text"
                >{{ review.anime.rating }}</span
              >
            </div>
            <div class="flex justify-between">
              <span class="text-sm text-text-light dark:text-text opacity-70"
                >Release Year</span
              >
              <span
                class="text-sm font-semibold text-text-light dark:text-text"
                >{{ review.anime.release_year }}</span
              >
            </div>
            <div class="flex justify-between">
              <span class="text-sm text-text-light dark:text-text opacity-70"
                >Global Score</span
              >
              <span
                class="text-sm font-semibold text-green-light dark:text-green"
                >{{ review.anime.score }}</span
              >
            </div>
          </div>

          <a
            [routerLink]="['/detail', review.anime_id]"
            class="block w-full mt-6 py-2 px-4 bg-surface0-light dark:bg-surface0 hover:bg-surface1-light dark:hover:bg-surface1 text-text-light dark:text-text font-semibold text-center rounded-lg transition-colors"
          >
            View Anime Details
          </a>
        </div>

        <div
          class="bg-base-light dark:bg-base rounded-xl shadow-lg border border-surface0-light dark:border-surface0 p-6 flex flex-col items-center text-center"
        >
          <img
            [src]="review.user.picture_url"
            class="w-20 h-20 rounded-full mb-3 border-2 border-lavender-light dark:border-lavender object-cover shadow-md"
          />
          <h4 class="text-lg font-bold text-text-light dark:text-text">
            {{ review.user.username }}
          </h4>
          <p class="text-sm text-text-light dark:text-text opacity-60 mb-4">
            Review Author
          </p>
          <a
            [routerLink]="['/reviews/user', review.user.id]"
            class="text-sm text-blue-light dark:text-blue hover:underline font-medium"
          >
            See all reviews by {{ review.user.username }}
          </a>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="!loading && !review && !error" class="text-center py-20">
    <p>Review not found.</p>
  </div>
</div>
